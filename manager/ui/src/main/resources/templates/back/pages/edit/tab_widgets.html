<form id="widgetAssociationForm" th:object="${createForm}" class="row">
    <div class="mb-3 col-12">
        <input type="hidden" th:field="*{pageId}"/>
        <div class="form-group mb-3" id="formInputWidget">
            <label th:text="#{widget.name.label}"/>
            <select th:field="*{widgetId}" class="form-control">
                <option value=""></option>
                <option th:each="linkableWidget : ${linkableWidgets}" th:value="${linkableWidget.id}"
                        th:text="${linkableWidget.name}"></option>
            </select>
            <div id="feedbackWidgetId" class="form-control-label"></div>
            <small class="form-text text-muted" th:text="#{widget.name.help}"/>
        </div>
        <div class="float-right">
            <a class="btn btn-md btn-success fa fa-plus fa-white" onclick="postCreateWidgetForm()"></a>
        </div>
    </div>
</form>
<div class="row mt-3" id="associatedWidgets">
    <div th:each="associatedWidget : ${linkedWidgets}" class="col-12 associatedWidgets">
        <div class="card mb-3">
            <div class="card-body">
                <div class="form-group">
                    <label th:text="#{widget.name.label}"/>
                    <input type="text" class="form-control" th:value="${associatedWidget.name}" disabled="true"/>
                </div>
                <div class="form-group">
                    <label th:text="#{widget.type.label}"/>
                    <input type="text" class="form-control" th:value="${associatedWidget.type}" disabled="true"/>
                </div>
                <div class="float-right mt-2">
                    <a class="btn btn-md btn-danger fa fa-times fa-white" th:id="${associatedWidget.id}"
                       onclick="deleteAssociatedWidget(this.id)"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    var deleteAssociatedWidget = function (idAssociatedWidget) {

        $("#widgetAssociationForm").hide();
        $("#associatedWidgets").hide();
        $(".loader").show();
        var url = "/manager/pages/" + [['' + ${createForm.pageId} +'']] + "/widgets/" + idAssociatedWidget;
        $.ajax({
            url: url,
            type: "DELETE",
            success: function () {
                currentTab = "";
                $(".loader").hide();
                goToWidgetsTab();
            },
            error: function () {
                currentTab = "";
                $(".loader").hide();
                goToWidgetsTab();

            }

        });
    }

    var postCreateWidgetForm = function () {
        $("#widgetAssociationForm").hide();
        $("#associatedWidgets").hide();
        $(".loader").show();
        var url = "/manager/pages/" + [['' + ${createForm.pageId} +'']] + "/widgets";

        var associatedWidgetForm = {};
        var inputWidgetId = $("#widgetId");
        var inputPageId = $("#pageId");

        associatedWidgetForm.widgetId = inputWidgetId.val();
        associatedWidgetForm.pageId = inputPageId.val();

        var data = JSON.stringify(associatedWidgetForm);
        $.ajax({
            type: "POST",
            url: url,
            data: data,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data) {
                currentTab = "";
                goToWidgetsTab();
                $(".loader").hide();
            },
            error: function () {
                currentTab = "";
                goToWidgetsTab();
                $(".loader").hide();
            }
        });
    }
    $(document).ready(function () {
            $(".card-loader").hide();
            $(".loader").hide();
        }
    );
</script>